<div>
  <ngx-spinner
    [name]="LOADERID"
    [fullScreen]="false"
    type="square-jelly-box"
    size="medium"
  ></ngx-spinner>
  <div class="row" style="margin-bottom: 5%">
    <mat-card>
      <div class="text-center">
        <h3>Créer référentiel</h3>
      </div>
      <form #addForm="ngForm" (submit)="save(addForm)">
        <div class="row" style="margin-bottom: 2%">
          <div class="col-md-12 col-lg-12 col-sm-12 col-xs-12">
            <div class="form-group row">
              <div class="col-md-6 col-lg-6 col-sm-12 col-xs-12">
                <mat-form-field class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                  <mat-select
                    required
                    name="niveau"
                    [(ngModel)]="niveauModel"
                    [placeholder]="
                      niveauModel
                        ? niveauModel.libelle
                          ? niveauModel.libelle
                          : 'Selectionnez le niveau'
                        : 'Selectionnez le niveau'
                    "
                  >
                    <mat-option
                      *ngFor="let niveau of listNiveau"
                      [value]="niveau"
                      >{{ niveau?.libelle }}</mat-option
                    >
                  </mat-select>
                </mat-form-field>
              </div>
              <div class="col-md-6 col-lg-6 col-sm-12 col-xs-12">
                <mat-form-field class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                  <mat-select
                    required
                    name="specialite"
                    [(ngModel)]="specialiteModel"
                    [placeholder]="
                      specialiteModel
                        ? specialiteModel.libelle
                          ? specialiteModel.libelle
                          : 'Selectionnez la spécialité'
                        : 'Selectionnez la spécialité'
                    "
                  >
                    <mat-option
                      *ngFor="let specialite of listSpecialite"
                      [value]="specialite"
                      >{{ specialite?.libelle }}</mat-option
                    >
                  </mat-select>
                </mat-form-field>
              </div>
            </div>
            <div class="form-group row">
              <div class="col-md-6 col-lg-6 col-sm-12 col-xs-12">
                <mat-form-field class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                  <mat-label>Année : </mat-label>
                  <input
                    [(ngModel)]="referentielModel.annee"
                    required
                    name="annee"
                    matInput
                  />
                </mat-form-field>
              </div>
              <div class="col-md-6 col-lg-6 col-sm-12 col-xs-12">
                <mat-form-field class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                  <mat-label>Crédit : </mat-label>
                  <input
                    [(ngModel)]="referentielModel.credit"
                    required
                    name="credit"
                    matInput
                  />
                </mat-form-field>
              </div>
            </div>
            <div class="form-group row">
              <div class="col-md-6 col-lg-6 col-sm-12 col-xs-12">
                <mat-form-field class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                  <mat-label>Volume heure total : </mat-label>
                  <input
                    [(ngModel)]="referentielModel.volumeHeureTotal"
                    required
                    name="libelle"
                    matInput
                  />
                </mat-form-field>
              </div>
              <div class="col-md-6 col-lg-6 col-sm-12 col-xs-12">
                <mat-form-field class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                  <mat-label>Description : </mat-label>
                  <textarea
                    rows="4"
                    cols="12"
                    [(ngModel)]="referentielModel.description"
                    required
                    name="libelle"
                    matInput
                  ></textarea>
                </mat-form-field>
              </div>
            </div>
          </div>
          <div class="col-md-12 col-lg-12 col-sm-12 col-xs-12">
            <button
              mat-raised-button
              color="primary"
              [disabled]="!addForm.valid"
              type="submit"
            >
              Enregistrer
              <em class="fa fa-save fa-lg"></em>
            </button>
          </div>
        </div>
      </form>
    </mat-card>
  </div>
  <div class="row" style="margin-bottom: 5%">
    <div class="text-center" style="margin-bottom: 3%">
      <h3>Liste référentiels</h3>
    </div>
    <div class="col-md-6 col-lg-6 col-sm-12 col-xs-12">
      <div class="col-md-10 col-lg-5 col-sm-12 col-xs-12">
        <div class="form-group row">
          <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
            <mat-form-field class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
              <mat-label>Niveau :</mat-label>
              <mat-select>
                <mat-option>Niveau 1</mat-option>
                <mat-option>Niveau 2</mat-option>
                <mat-option>Niveau 3</mat-option>
              </mat-select>
            </mat-form-field>
          </div>
        </div>
      </div>
      <div class="col-md-10 col-lg-5 col-sm-12 col-xs-12">
        <div class="form-group row">
          <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
            <mat-form-field class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
              <mat-label>Spécialité :</mat-label>
              <mat-select>
                <mat-option>Spécialité 1</mat-option>
                <mat-option>Spécialité 2</mat-option>
                <mat-option>Spécialité 3</mat-option>
              </mat-select>
            </mat-form-field>
          </div>
        </div>
      </div>
      <div class="col-md-10 col-lg-2 col-sm-12 col-xs-12">
        <button
          mat-mini-fab
          color="primary"
          style="background-color: whitesmoke; color: black"
          data-toggle="modal"
          data-target="#addModal"
        >
          <em class="fa fa-search fa-lg"></em>
        </button>
      </div>
    </div>
    <div class="col-md-6 col-lg-6 col-sm-12 col-xs-12">
      <mat-card>
        <div class="row">
          <div class="col-md-6 col-lg-6 col-sm-12 col-xs-12">
            <p>
              <em class="fa fa-square" style="color: rgb(161, 32, 32)"></em
              >&nbsp;&nbsp;69 classes à programme vide
            </p>
          </div>
          <div class="col-md-6 col-lg-6 col-sm-12 col-xs-12">
            <p>
              <em class="fa fa-square" style="color: rgb(161, 32, 32)"></em
              >&nbsp;&nbsp;69 classes à programme vide
            </p>
          </div>
          <div class="col-md-6 col-lg-6 col-sm-12 col-xs-12">
            <p>
              <em class="fa fa-square" style="color: rgb(161, 32, 32)"></em
              >&nbsp;&nbsp;69 classes à programme vide
            </p>
          </div>
          <div class="col-md-6 col-lg-6 col-sm-12 col-xs-12">
            <p>
              <em class="fa fa-square" style="color: rgb(161, 32, 32)"></em
              >&nbsp;&nbsp;69 classes à programme vide
            </p>
          </div>
          <div class="col-md-6 col-lg-6 col-sm-12 col-xs-12">
            <p>
              <em class="fa fa-square" style="color: rgb(161, 32, 32)"></em
              >&nbsp;&nbsp;69 classes à programme vide
            </p>
          </div>
          <div class="col-md-6 col-lg-6 col-sm-12 col-xs-12">
            <p>
              <em class="fa fa-square" style="color: rgb(161, 32, 32)"></em
              >&nbsp;&nbsp;69 classes à programme vide
            </p>
          </div>
          <div class="col-md-6 col-lg-6 col-sm-12 col-xs-12">
            <p>
              <em class="fa fa-square" style="color: rgb(161, 32, 32)"></em
              >&nbsp;&nbsp;69 classes à programme vide
            </p>
          </div>
          <div class="col-md-6 col-lg-6 col-sm-12 col-xs-12">
            <p>
              <em class="fa fa-square" style="color: rgb(161, 32, 32)"></em
              >&nbsp;&nbsp;69 classes à programme vide
            </p>
          </div>
        </div>
      </mat-card>
    </div>
  </div>

  <mat-card id="tableCard">
    <table class="table table-striped table-responsive">
      <thead>
        <tr>
          <th>Année</th>
          <th>Crédit</th>
          <th>VHT</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <ng-container
          *ngFor="
            let referentiel of listReferentiel
              | paginate: { itemsPerPage: 5, currentPage: page };
            let i = index
          "
        >
          <tr>
            <td>{{ referentiel.annee }}</td>
            <td>{{ referentiel.credit }}</td>
            <td>{{ referentiel.volumeHeureTotal }}</td>
            <td>
              <button
                style="background: transparent"
                matTooltip="Ajouter"
                mat-flat-button
              >
                <em class="fa fa-plus fa-lg"> </em>
              </button>
              &nbsp;&nbsp;
              <button
                style="background: transparent"
                (click)="
                  referentiel.expanded = !referentiel.expanded;
                  loadListProgrammeUE(referentiel)
                "
                matTooltip="Lister"
                mat-flat-button
              >
                <em class="fa fa-list fa-lg"> </em>
              </button>
            </td>
          </tr>

          <ng-container *ngIf="referentiel.expanded" [@flyInOut]>
            <ngx-spinner
              [name]="LOADERPROGRAMMEUE"
              [fullScreen]="false"
              type="square-jelly-box"
              size="medium"
            ></ngx-spinner>
            <tr>
              <th>Désignation</th>
              <th>Semestre</th>
              <th>Crédit</th>
              <th>Fondamental</th>
              <th>Nombre heure UE</th>
              <th>
                Actions&nbsp;&nbsp;
                <button
                  style="background: transparent"
                  type="button"
                  (click)="
                    expandedNewProgrammeUE = !expandedNewProgrammeUE;
                    onAddNewProgrammeUE()
                  "
                  mat-flat-button
                  matTooltip="Ajouter"
                >
                  <em class="fa fa-plus fa-lg"></em>
                </button>
              </th>
            </tr>

            <!-- form to add new programme ue -->
            <ng-container *ngIf="expandedNewProgrammeUE" [@flyInOut]>
              <tr>
                <td>
                  <mat-form-field
                    class="col-lg-12 col-md-12 col-sm-12 col-xs-12"
                  >
                    <mat-select
                      required
                      name="ue"
                      [(ngModel)]="ueModel"
                      [placeholder]="
                        ueModel
                          ? ueModel.libelle
                            ? ueModel.libelle
                            : 'Selectionnez l\'ue'
                          : 'Selectionnez l\'ue'
                      "
                    >
                      <mat-option *ngFor="let ue of listUe" [value]="ue">{{
                        ue?.libelle
                      }}</mat-option>
                    </mat-select>
                  </mat-form-field>
                </td>
                <td>
                  <mat-form-field
                    class="col-lg-12 col-md-12 col-sm-12 col-xs-12"
                  >
                    <mat-select
                      required
                      name="semestre"
                      [(ngModel)]="semestreModel"
                      [placeholder]="
                        semestreModel
                          ? semestreModel.libelle
                            ? semestreModel.libelle
                            : 'Selectionnez le semestre'
                          : 'Selectionnez le semestre'
                      "
                    >
                      <mat-option
                        *ngFor="let semestre of listSemestre"
                        [value]="semestre"
                        >{{ semestre?.libelle }}</mat-option
                      >
                    </mat-select>
                  </mat-form-field>
                </td>

                <td>
                  <mat-form-field
                    class="col-lg-12 col-md-12 col-sm-12 col-xs-12"
                  >
                    <mat-label>Crédit : </mat-label>
                    <input
                      [(ngModel)]="programmeUEModel.credit"
                      required
                      name="credit"
                      matInput
                    />
                  </mat-form-field>
                </td>
                <td>
                  <mat-form-field
                    class="col-lg-12 col-md-12 col-sm-12 col-xs-12"
                  >
                    <mat-label>Fondamental : </mat-label>
                    <input
                      [(ngModel)]="programmeUEModel.fondamental"
                      required
                      name="fondamental"
                      matInput
                    />
                  </mat-form-field>
                </td>
                <td>
                  <mat-form-field
                    class="col-lg-12 col-md-12 col-sm-12 col-xs-12"
                  >
                    <mat-label>Nombre heure UE : </mat-label>
                    <input
                      [(ngModel)]="programmeUEModel.nbreHeureUE"
                      required
                      name="nbreHeureUE"
                      matInput
                    />
                  </mat-form-field>
                </td>
                <td>
                  <button
                    (click)="saveProgrammeUE(referentiel)"
                    mat-raised-button
                    color="primary"
                    type="button"
                  >
                    Enregistrer
                    <em class="fa fa-save fa-lg"></em>
                  </button>
                </td>
              </tr>
            </ng-container>
            <!-- End form to add new programme ue -->

            <!-- list programme ue by referentiel-->
            <ng-container *ngFor="let programmeUE of listProgrammeUE">
              <tr>
                <td>{{ programmeUE.ue.libelle }}</td>
                <td>{{ programmeUE.semestre.libelle }}</td>
                <td>{{ programmeUE.credit }}</td>
                <td>{{ programmeUE.fondamental }}</td>
                <td>{{ programmeUE.nbreHeureUE }}</td>
                <td>L3</td>
                <td>
                  <button
                    style="background: transparent"
                    matTooltip="Modifier"
                    mat-flat-button
                  >
                    <em class="fa fa-edit fa-lg"> </em>
                  </button>
                  &nbsp;&nbsp;
                  <button
                    style="background: transparent"
                    matTooltip="Suprimmer"
                    mat-flat-button
                  >
                    <em class="fa fa-trash fa-lg"> </em>
                  </button>
                  &nbsp;&nbsp;
                  <button
                    (click)="
                      programmeUE.expanded = !programmeUE.expanded;
                      loadListProgrammeModule(programmeUE)
                    "
                    style="background: transparent"
                    matTooltip="Lister"
                    mat-flat-button
                  >
                    <em class="fa fa-list fa-lg"> </em>
                  </button>
                </td>
              </tr>

              <!-- list Programme module by programme ue -->
              <ng-container *ngIf="programmeUE.expanded">
                <tr>
                  <th>Nom</th>
                  <th>Budget</th>
                  <th>Coef</th>
                  <th>Nbre Crédit module</th>
                  <th>TD</th>
                  <th>TP</th>
                  <th>TPE</th>
                  <th>VH</th>
                  <th>VHT</th>
                  <th>
                    Actions&nbsp;&nbsp;
                    <button
                      style="background: transparent"
                      type="button"
                      (click)="
                        expandedNewProgrammeModule = !expandedNewProgrammeModule;
                        onAddNewProgrammeModule()
                      "
                      mat-flat-button
                      matTooltip="Ajouter"
                    >
                      <em class="fa fa-plus fa-lg"></em>
                    </button>
                  </th>
                </tr>

                <!-- form to add new ProgrammeModule -->
                <ng-container *ngIf="expandedNewProgrammeModule" [@flyInOut]>
                  <tr>
                    <td>
                      <mat-form-field
                        class="col-lg-12 col-md-12 col-sm-12 col-xs-12"
                      >
                        <mat-select
                          required
                          name="module"
                          [(ngModel)]="moduleModel"
                          [placeholder]="
                            moduleModel
                              ? moduleModel.libelle
                                ? moduleModel.libelle
                                : 'Selectionnez le module'
                              : 'Selectionnez le module'
                          "
                        >
                          <mat-option
                            *ngFor="let module of listModule"
                            [value]="module"
                            >{{ module?.libelle }}</mat-option
                          >
                        </mat-select>
                      </mat-form-field>
                    </td>
                    <td>
                      <mat-form-field
                        class="col-lg-12 col-md-12 col-sm-12 col-xs-12"
                      >
                        <mat-label>Budget : </mat-label>
                        <input
                          [(ngModel)]="programmeModuleModel.budget"
                          required
                          name="budget"
                          matInput
                        />
                      </mat-form-field>
                    </td>
                    <td>
                      <mat-form-field
                        class="col-lg-12 col-md-12 col-sm-12 col-xs-12"
                      >
                        <mat-label>Coef : </mat-label>
                        <input
                          [(ngModel)]="programmeModuleModel.coef"
                          required
                          name="coef"
                          matInput
                        />
                      </mat-form-field>
                    </td>
                    <td>
                      <mat-form-field
                        class="col-lg-12 col-md-12 col-sm-12 col-xs-12"
                      >
                        <mat-label>Nbre credit module : </mat-label>
                        <input
                          [(ngModel)]="programmeModuleModel.nbreCreditModule"
                          required
                          name="nbreCreditModule"
                          matInput
                        />
                      </mat-form-field>
                    </td>
                    <td>
                      <mat-form-field
                        class="col-lg-12 col-md-12 col-sm-12 col-xs-12"
                      >
                        <mat-label>TD : </mat-label>
                        <input
                          [(ngModel)]="programmeModuleModel.td"
                          required
                          name="td"
                          matInput
                        />
                      </mat-form-field>
                    </td>
                    <td>
                      <mat-form-field
                        class="col-lg-12 col-md-12 col-sm-12 col-xs-12"
                      >
                        <mat-label>TP : </mat-label>
                        <input
                          [(ngModel)]="programmeModuleModel.tp"
                          required
                          name="tp"
                          matInput
                        />
                      </mat-form-field>
                    </td>
                    <td>
                      <mat-form-field
                        class="col-lg-12 col-md-12 col-sm-12 col-xs-12"
                      >
                        <mat-label>TPE : </mat-label>
                        <input
                          [(ngModel)]="programmeModuleModel.tpe"
                          required
                          name="tpe"
                          matInput
                        />
                      </mat-form-field>
                    </td>
                    <td>
                      <mat-form-field
                        class="col-lg-12 col-md-12 col-sm-12 col-xs-12"
                      >
                        <mat-label>VH : </mat-label>
                        <input
                          [(ngModel)]="programmeModuleModel.vh"
                          required
                          name="vh"
                          matInput
                        />
                      </mat-form-field>
                    </td>
                    <td>
                      <mat-form-field
                        class="col-lg-12 col-md-12 col-sm-12 col-xs-12"
                      >
                        <mat-label>VHT : </mat-label>
                        <input
                          [(ngModel)]="programmeModuleModel.vht"
                          required
                          name="vht"
                          matInput
                        />
                      </mat-form-field>
                    </td>
                    <td>
                      <button
                        mat-raised-button
                        color="primary"
                        type="button"
                        (click)="saveProgrammeModule(programmeUE)"
                      >
                        Enregistrer
                        <em class="fa fa-save fa-lg"></em>
                      </button>
                    </td>
                  </tr>
                </ng-container>
                <!-- End form to add new ProgrammeModule -->

                <!-- list container ProgrammeModule -->
                <ng-container
                  *ngFor="let programmeModule of listProgrammeModule"
                >
                  <tr>
                    <td>{{ programmeModule.module.libelle }}</td>
                    <td>{{ programmeModule.budget }}</td>
                    <td>{{ programmeModule.coef }}</td>
                    <td>{{ programmeModule.nbreCreditModule }}</td>
                    <td>{{ programmeModule.td }}</td>
                    <td>{{ programmeModule.tp }}</td>
                    <td>{{ programmeModule.tpe }}</td>
                    <td>{{ programmeModule.vh }}</td>
                    <td>{{ programmeModule.vht }}</td>
                    <td>
                      <button
                        style="background: transparent"
                        matTooltip="Modifier"
                        mat-flat-button
                      >
                        <em class="fa fa-edit fa-lg"> </em>
                      </button>
                      &nbsp;&nbsp;
                      <button
                        style="background: transparent"
                        matTooltip="Suprimmer"
                        mat-flat-button
                      >
                        <em class="fa fa-trash fa-lg"> </em>
                      </button>
                    </td>
                  </tr>
                </ng-container>
                <!-- End list container ProgrammeModule -->
              </ng-container>
              <!-- end list Programme module by programme ue -->
            </ng-container>
            <!-- list programme ue by referentiel-->
          </ng-container>
        </ng-container>
      </tbody>
    </table>
  </mat-card>
</div>
